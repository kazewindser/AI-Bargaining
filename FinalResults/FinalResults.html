

{% load otree %}

{% block title %}çµæœ{% endblock %}

{% block content %}

<div class="card">
    <div class="card-body">
        <h3>æœ€çµ‚æ”¯æ‰•æƒ…å ±</h3>

        <div style="background-color: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
            <p style="margin: 0; font-size: 1.1em;">
                <b>ğŸ² æŠ½é¸ã•ã‚ŒãŸãƒ©ã‚¦ãƒ³ãƒ‰: ç¬¬ {{ pay_round }} ãƒ©ã‚¦ãƒ³ãƒ‰</b>
            </p>
            <p style="margin: 5px 0 0 0; color: #666;">
                ã‚ãªãŸã®å½¹å‰²: <b>{{ my_role }}</b>
            </p>
        </div>

        <p>ç²å¾—ã—ãŸå¾—ç‚¹(å‰²å¼•å¾Œ)ï¼š<b>{{ my_points }}</b> ç‚¹</p>

        {% if payment_source == 'ai' %}
            <p><small style="color: #666;">ğŸ’¡ è‡ªåˆ†ã¨åŒã˜å½¹å‰²ã®AIãŒç²å¾—ã—ãŸãƒã‚¤ãƒ³ãƒˆã«åŸºã¥ã„ã¦è¬é‡‘ã‚’è¨ˆç®—ã™ã‚‹</small></p>
        {% elif payment_source == 'fallback' %}
            <p><small style="color: #FF9800;">âš ï¸ è©²å½“ã™ã‚‹AIãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€ã‚ãªãŸè‡ªèº«ã®åç›Šã‚’ä½¿ç”¨ã—ã¾ã—ãŸ</small></p>
        {% elif payment_source == 'own' %}
            <p><small style="color: #666;">âœ“ ã‚ãªãŸè‡ªèº«ãŒç²å¾—ã—ãŸãƒã‚¤ãƒ³ãƒˆã«åŸºã¥ã„ãŸè¬é‡‘ã‚’è¨ˆç®—ã™ã‚‹</small></p>
        {% endif %}

        <hr>

        <div style="background-color: #f0f8ff; padding: 25px; border-radius: 10px; margin-top: 20px; text-align: center;">
            <p style="font-size:1.1em; color: #555; margin-bottom: 10px;">
                ã‚ãªãŸãŒå—ã‘å–ã‚‹è¬é‡‘ã¯ã€å‚åŠ è¬é‡‘ï¼•ï¼ï¼å††ã¨äº¤æ¸‰ã‚²ãƒ¼ãƒ ã§ç²å¾—ã—ãŸè¬é‡‘ã®åˆè¨ˆã§
            </p>
            <p style="font-size:1.4em; margin: 10px 0;">
                {{ my_points }} ç‚¹ Ã— {{ multiplier }} + {{ base_bonus }} =
            </p>
            <p style="margin: 0;">
                <b style="color: #4CAF50; font-size: 2em;">{{ final_payment }} å††</b>
            </p>
        </div>

        <hr style="margin-top: 40px;">
        <h4 style="margin-bottom: 20px;">ğŸ“Š å…¨ãƒ©ã‚¦ãƒ³ãƒ‰ã®è©³ç´°çµæœ</h4>

        {% if all_rounds_data %}
            <div style="overflow-x: auto; margin-top: 15px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                    <thead>
                        <tr style="background-color: #f5f5f5;">
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">ãƒ©ã‚¦ãƒ³ãƒ‰</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">å½¹å‰²</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">å¾—ç‚¹</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">ã‚¹ãƒ†ãƒ¼ã‚¸</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">çµæœ</th>
                            {% if used_ai_payoff %}
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">ãƒ‡ãƒ¼ã‚¿å…ƒ</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for data in all_rounds_data %}
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                    ç¬¬{{ data.round }}ãƒ©ã‚¦ãƒ³ãƒ‰
                                    {% if used_ai_payoff %}
                                        {% if data.round == original_selected_round and not data.is_ai %}
                                            <span style="color: #FF9800;" title="ã‚ãªãŸãŒæœ€åˆã«æŠ½é¸ã•ã‚ŒãŸãƒ©ã‚¦ãƒ³ãƒ‰">â—†</span>
                                        {% endif %}
                                        {% if data.round == ai_selected_round and data.is_ai and data.participant_id == ai_participant_id %}
                                            <span style="color: #4CAF50;" title="è¬é‡‘è¨ˆç®—ã«ä½¿ç”¨ã•ã‚ŒãŸAIã®ãƒ©ã‚¦ãƒ³ãƒ‰">â˜…</span>
                                        {% endif %}
                                    {% else %}
                                        {% if data.round == pay_round %}
                                            <span style="color: #4CAF50;" title="è¬é‡‘è¨ˆç®—ã«ä½¿ç”¨ã•ã‚ŒãŸãƒ©ã‚¦ãƒ³ãƒ‰">â˜…</span>
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">{{ data.role }}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                    <b>{{ data.points }}</b> ç‚¹
                                </td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                    ã‚¹ãƒ†ãƒ¼ã‚¸ {{ data.stage }}
                                </td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                    {% if data.accepted %}
                                        <span style="color: #4CAF50;">âœ“ å—è«¾</span>
                                    {% else %}
                                        <span style="color: #f44336;">âœ— æ‹’å¦</span>
                                    {% endif %}
                                </td>
                                {% if used_ai_payoff %}
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                        {% if data.is_ai %}
                                            <span style="color: #2196F3; font-weight: bold;">ğŸ¤– AI (å‚åŠ è€…{{ data.participant_id }})</span>
                                        {% else %}
                                            <span style="color: #666;">ğŸ‘¤ ã‚ãªãŸ</span>
                                        {% endif %}
                                    </td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="text-align: center; color: #999; padding: 20px;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        {% endif %}

        <p style="margin-top: 10px; font-size: 0.85em; color: #666;">
            {% if used_ai_payoff %}
                <b>â—†</b> ãƒãƒ¼ã‚¯ã¯ã‚ãªãŸãŒæœ€åˆã«æŠ½é¸ã•ã‚ŒãŸãƒ©ã‚¦ãƒ³ãƒ‰ã‚’ç¤ºã—ã¾ã™<br>
                <b>â˜…</b> ãƒãƒ¼ã‚¯ã¯è¬é‡‘è¨ˆç®—ã«å®Ÿéš›ã«ä½¿ç”¨ã•ã‚ŒãŸAIã®ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’ç¤ºã—ã¾ã™<br>
                <b>ğŸ¤– AI</b> ã¯ä»–ã®å‚åŠ è€…ã®ãƒ‡ãƒ¼ã‚¿ã€<b>ğŸ‘¤ ã‚ãªãŸ</b> ã¯ã‚ãªãŸè‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¤ºã—ã¾ã™
            {% else %}
                <b>â˜…</b> ãƒãƒ¼ã‚¯ã¯è¬é‡‘è¨ˆç®—ã«ä½¿ç”¨ã•ã‚ŒãŸãƒ©ã‚¦ãƒ³ãƒ‰ã‚’ç¤ºã—ã¾ã™
            {% endif %}
        </p>

        <div style="margin-top: 40px; padding: 20px; background-color: #f9f9f9; border-radius: 5px;">
            <p style="margin: 0; text-align: center; color: #666;">
                å®Ÿé¨“ã«ã”å‚åŠ ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚<br>
                ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼
            </p>
        </div>
    </div>
</div>

{% next_button %}

{% endblock %}